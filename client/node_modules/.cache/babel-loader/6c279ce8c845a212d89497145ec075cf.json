{"ast":null,"code":"var _jsxFileName = \"/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js\";\nimport React from \"react\";\nimport io from 'socket.io-client';\nimport './styles/broadcaster.style.css';\nimport configs from '../config';\nimport authService from \"../services/auth.service\";\nimport NavBar from \"../components/navbar.component\";\nimport ChatContainer from \"../components/chat.component\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass BroadCaster extends React.Component {\n  constructor() {\n    super(); // check if user did not sign in\n\n    this.StopStreaming = () => {};\n\n    this.SwitchShare = () => {};\n\n    let user = authService.getCurrentUser();\n\n    if (!user) {\n      this.props.history.push('/login');\n      window.location.reload();\n    }\n\n    this.state = {\n      // client list\n      peerConnections: {},\n      // socket connection\n      socket: io(`${configs.API_URL}`),\n      user: JSON.parse(user)\n    };\n  }\n\n  componentDidMount() {\n    const video = document.querySelector(\"video\"); // Use camera\n    // navigator.mediaDevices\n    //     .getUserMedia(configs.VIDEO_CONSTRAINS)\n    //     .then(stream => {\n    //         video.srcObject = stream;\n    //         this.state.socket.emit(\"broadcaster\", this.state.user.name);\n    //     })\n    //     .catch(error => console.error(error));\n    // Use screen\n\n    navigator.mediaDevices.getDisplayMedia(configs.VIDEO_CONSTRAINS).then(function (mediaStream) {\n      video.srcObject = mediaStream;\n    }).catch(function (err) {\n      console.log(err.name + \": \" + err.message);\n    }); // Socket handler\n\n    this.state.socket.on(\"start-watching\", clientId => {\n      const peerConnection = new RTCPeerConnection(configs.STUN_CONFIG); // update state\n\n      this.setState(prevState => {\n        let newPeerConnections = prevState.peerConnections;\n        newPeerConnections[clientId] = peerConnection;\n        return {\n          socket: this.state.socket,\n          peerConnections: newPeerConnections\n        };\n      });\n      let streamCamera = video.srcObject;\n      streamCamera.getTracks().forEach(track => {\n        peerConnection.addTrack(track, streamCamera);\n      });\n\n      peerConnection.onicecandidate = event => {\n        if (event.candidate) {\n          this.state.socket.emit(\"candidate\", clientId, event.candidate);\n        }\n      };\n\n      peerConnection.createOffer().then(sdp => peerConnection.setLocalDescription(sdp)).then(() => {\n        this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n      });\n    });\n    this.state.socket.on(\"answer\", (id, description) => {\n      this.state.peerConnections[id].setRemoteDescription(description);\n    });\n    this.state.socket.on(\"candidate\", (id, candidate) => {\n      this.state.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n    });\n    this.state.socket.on(\"disconnectPeer\", id => {\n      this.state.peerConnections[id].close();\n      delete this.state.peerConnections[id];\n      console.log(this.state.peerConnections);\n    });\n\n    window.onunload = window.onbeforeunload = () => {\n      this.state.socket.close();\n    };\n  } // Stop streamming\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(NavBar, {\n        user: this.state.user,\n        history: this.props.history,\n        isStreaming: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        style: {\n          margin: '0'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"stream-screen\",\n          className: \"col-md-8\",\n          style: {\n            textAlign: 'center',\n            backgroundColor: 'black',\n            margin: '0'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"video\", {\n            id: \"camera\",\n            playsInline: true,\n            autoPlay: true,\n            muted: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-4\",\n          style: {\n            margin: '0'\n          },\n          children: /*#__PURE__*/_jsxDEV(ChatContainer, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default BroadCaster;","map":{"version":3,"sources":["/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js"],"names":["React","io","configs","authService","NavBar","ChatContainer","BroadCaster","Component","constructor","StopStreaming","SwitchShare","user","getCurrentUser","props","history","push","window","location","reload","state","peerConnections","socket","API_URL","JSON","parse","componentDidMount","video","document","querySelector","navigator","mediaDevices","getDisplayMedia","VIDEO_CONSTRAINS","then","mediaStream","srcObject","catch","err","console","log","name","message","on","clientId","peerConnection","RTCPeerConnection","STUN_CONFIG","setState","prevState","newPeerConnections","streamCamera","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","emit","createOffer","sdp","setLocalDescription","localDescription","id","description","setRemoteDescription","addIceCandidate","RTCIceCandidate","close","onunload","onbeforeunload","render","margin","textAlign","backgroundColor"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport io from 'socket.io-client'\nimport './styles/broadcaster.style.css'\nimport configs from '../config'\nimport authService from \"../services/auth.service\";\nimport NavBar from \"../components/navbar.component\";\nimport ChatContainer from \"../components/chat.component\";\n\nclass BroadCaster extends React.Component {\n    constructor() {\n        super()\n\n        // check if user did not sign in\n        let user = authService.getCurrentUser();\n        if (!user) {\n            this.props.history.push('/login')\n            window.location.reload()\n        }\n\n        this.state = {\n            // client list\n            peerConnections: {},\n            // socket connection\n            socket: io(`${configs.API_URL}`),\n            user: JSON.parse(user)\n        }\n    }\n\n    componentDidMount() {\n        const video = document.querySelector(\"video\");\n\n        // Use camera\n        // navigator.mediaDevices\n        //     .getUserMedia(configs.VIDEO_CONSTRAINS)\n        //     .then(stream => {\n        //         video.srcObject = stream;\n        //         this.state.socket.emit(\"broadcaster\", this.state.user.name);\n        //     })\n        //     .catch(error => console.error(error));\n\n        // Use screen\n        navigator.mediaDevices.getDisplayMedia(configs.VIDEO_CONSTRAINS)\n            .then(function (mediaStream) {\n                video.srcObject = mediaStream;\n            })\n            .catch(function (err) { console.log(err.name + \": \" + err.message); });\n\n        // Socket handler\n        this.state.socket.on(\"start-watching\", clientId => {\n            const peerConnection = new RTCPeerConnection(configs.STUN_CONFIG);\n\n            // update state\n            this.setState(prevState => {\n                let newPeerConnections = prevState.peerConnections\n                newPeerConnections[clientId] = peerConnection\n                return {\n                    socket: this.state.socket,\n                    peerConnections: newPeerConnections\n                }\n            })\n\n            let streamCamera = video.srcObject;\n            streamCamera.getTracks().forEach(track => {\n                peerConnection.addTrack(track, streamCamera)\n            });\n\n            peerConnection.onicecandidate = event => {\n                if (event.candidate) {\n                    this.state.socket.emit(\"candidate\", clientId, event.candidate);\n                }\n            };\n\n            peerConnection\n                .createOffer()\n                .then(sdp => peerConnection.setLocalDescription(sdp))\n                .then(() => {\n                    this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n                });\n        });\n\n        this.state.socket.on(\"answer\", (id, description) => {\n            this.state.peerConnections[id].setRemoteDescription(description);\n        });\n\n        this.state.socket.on(\"candidate\", (id, candidate) => {\n            this.state.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n        });\n\n        this.state.socket.on(\"disconnectPeer\", id => {\n            this.state.peerConnections[id].close();\n            delete this.state.peerConnections[id];\n            console.log(this.state.peerConnections)\n        });\n\n        window.onunload = window.onbeforeunload = () => {\n            this.state.socket.close();\n        };\n    }\n\n    // Stop streamming\n    StopStreaming = () => {\n\n    }\n\n    // Start streaming\n    SwitchShare = () => {\n\n    }\n\n    render() {\n        return (\n            <div>\n                <NavBar user={this.state.user} history={this.props.history} isStreaming={true} />\n                <div className='row' style={{margin:'0'}}>\n                    <div id='stream-screen' className=\"col-md-8\" style={{textAlign:'center', backgroundColor:'black', margin:'0'}}>\n                        <video id='camera' playsInline autoPlay muted></video>\n                    </div>\n                    <div className=\"col-md-4\" style={{margin:'0'}}>\n                        <ChatContainer />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default BroadCaster;"]},"metadata":{},"sourceType":"module"}