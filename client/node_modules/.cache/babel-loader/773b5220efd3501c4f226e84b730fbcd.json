{"ast":null,"code":"var _jsxFileName = \"/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js\";\nimport React from \"react\";\nimport io from 'socket.io-client';\nimport '../styles/home.style.css';\nimport { config } from '../config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass BroadCaster extends React.Component {\n  constructor() {\n    super();\n\n    this.StopStreaming = () => {};\n\n    this.ShareScreen = () => {\n      const videoScreen = document.getElementById(\"screen\");\n      navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS).then(function (mediaStream) {\n        videoScreen.srcObject = mediaStream;\n      }).catch(function (err) {\n        console.log(err.name + \": \" + err.message);\n      });\n      const peerConnection = new RTCPeerConnection(config.STUN_CONFIG); // update state\n\n      this.setState(prevState => {\n        let newPeerConnections = prevState.peerConnections;\n        newPeerConnections[clientId] = peerConnection;\n        return {\n          socket: this.state.socket,\n          peerConnections: newPeerConnections\n        };\n      });\n      let streamScreen = videoScreen.srcObject;\n      streamScreen.getTracks().forEach(track => {\n        peerConnection.addTrack(track, streamScreen);\n      });\n\n      peerConnection.onicecandidate = event => {\n        if (event.candidate) {\n          this.state.socket.emit(\"candidate\", clientId, event.candidate);\n        }\n      };\n\n      peerConnection.createOffer().then(sdp => peerConnection.setLocalDescription(sdp)).then(() => {\n        this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n      });\n    };\n\n    this.state = {\n      // client list\n      peerConnections: {},\n      // socket connection\n      socket: io(`${config.NODE_IP}:${config.NODE_PORT}`)\n    };\n  }\n\n  componentDidMount() {\n    // Use camera\n    const videoCamera = document.getElementById(\"camera\");\n    navigator.mediaDevices.getUserMedia(config.VIDEO_CONSTRAINS).then(stream => {\n      videoCamera.srcObject = stream;\n      this.state.socket.emit(\"broadcaster\");\n    }).catch(error => console.error(error)); // Use screen\n\n    const videoScreen = document.getElementById(\"screen\");\n    navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS).then(function (mediaStream) {\n      videoScreen.srcObject = mediaStream;\n    }).catch(function (err) {\n      console.log(err.name + \": \" + err.message);\n    }); // Socket handler\n\n    this.state.socket.on(\"start-watching\", clientId => {\n      const peerConnection = new RTCPeerConnection(config.STUN_CONFIG); // update state\n\n      this.setState(prevState => {\n        let newPeerConnections = prevState.peerConnections;\n        newPeerConnections[clientId] = peerConnection;\n        return {\n          socket: this.state.socket,\n          peerConnections: newPeerConnections\n        };\n      });\n      let streamCamera = videoCamera.srcObject;\n      streamCamera.getTracks().forEach(track => {\n        peerConnection.addTrack(track, streamCamera);\n      });\n\n      peerConnection.onicecandidate = event => {\n        if (event.candidate) {\n          this.state.socket.emit(\"candidate\", clientId, event.candidate);\n        }\n      };\n\n      peerConnection.createOffer().then(sdp => peerConnection.setLocalDescription(sdp)).then(() => {\n        this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n      });\n    });\n    this.state.socket.on(\"answer\", (id, description) => {\n      this.state.peerConnections[id].setRemoteDescription(description);\n    });\n    this.state.socket.on(\"candidate\", (id, candidate) => {\n      this.state.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n    });\n    this.state.socket.on(\"disconnectPeer\", id => {\n      this.state.peerConnections[id].close();\n      delete this.state.peerConnections[id];\n      console.log(this.state.peerConnections);\n    });\n\n    window.onunload = window.onbeforeunload = () => {\n      this.state.socket.close();\n    };\n  } // Stop streamming\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"User: hoangnd\\xA0\", /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"control-btn\",\n        onClick: this.ShareScreen,\n        children: \"Share screen\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"stream-screen\",\n        style: {\n          margin: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          id: \"camera\",\n          playsInline: true,\n          autoPlay: true,\n          muted: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 21\n        }, this), \"\\xA0 \\xA0 \\xA0\", /*#__PURE__*/_jsxDEV(\"video\", {\n          id: \"screen\",\n          playsInline: true,\n          autoPlay: true,\n          muted: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default BroadCaster;","map":{"version":3,"sources":["/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js"],"names":["React","io","config","BroadCaster","Component","constructor","StopStreaming","ShareScreen","videoScreen","document","getElementById","navigator","mediaDevices","getDisplayMedia","VIDEO_CONSTRAINS","then","mediaStream","srcObject","catch","err","console","log","name","message","peerConnection","RTCPeerConnection","STUN_CONFIG","setState","prevState","newPeerConnections","peerConnections","clientId","socket","state","streamScreen","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","emit","createOffer","sdp","setLocalDescription","localDescription","NODE_IP","NODE_PORT","componentDidMount","videoCamera","getUserMedia","stream","error","on","streamCamera","id","description","setRemoteDescription","addIceCandidate","RTCIceCandidate","close","window","onunload","onbeforeunload","render","margin"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAO,0BAAP;AACA,SAASC,MAAT,QAAuB,WAAvB;;;AAEA,MAAMC,WAAN,SAA0BH,KAAK,CAACI,SAAhC,CAA0C;AACtCC,EAAAA,WAAW,GAAG;AACV;;AADU,SAmFdC,aAnFc,GAmFE,MAAM,CAErB,CArFa;;AAAA,SAwFdC,WAxFc,GAwFA,MAAM;AAChB,YAAMC,WAAW,GAAGC,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAApB;AAEAC,MAAAA,SAAS,CAACC,YAAV,CAAuBC,eAAvB,CAAuCX,MAAM,CAACY,gBAA9C,EACKC,IADL,CACU,UAAUC,WAAV,EAAuB;AACzBR,QAAAA,WAAW,CAACS,SAAZ,GAAwBD,WAAxB;AACH,OAHL,EAIKE,KAJL,CAIW,UAAUC,GAAV,EAAe;AAAEC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAJ,GAAW,IAAX,GAAkBH,GAAG,CAACI,OAAlC;AAA6C,OAJzE;AAMA,YAAMC,cAAc,GAAG,IAAIC,iBAAJ,CAAsBvB,MAAM,CAACwB,WAA7B,CAAvB,CATgB,CAWhB;;AACA,WAAKC,QAAL,CAAcC,SAAS,IAAI;AACvB,YAAIC,kBAAkB,GAAGD,SAAS,CAACE,eAAnC;AACAD,QAAAA,kBAAkB,CAACE,QAAD,CAAlB,GAA+BP,cAA/B;AACA,eAAO;AACHQ,UAAAA,MAAM,EAAE,KAAKC,KAAL,CAAWD,MADhB;AAEHF,UAAAA,eAAe,EAAED;AAFd,SAAP;AAIH,OAPD;AASA,UAAIK,YAAY,GAAG1B,WAAW,CAACS,SAA/B;AACAiB,MAAAA,YAAY,CAACC,SAAb,GAAyBC,OAAzB,CAAiCC,KAAK,IAAI;AACtCb,QAAAA,cAAc,CAACc,QAAf,CAAwBD,KAAxB,EAA+BH,YAA/B;AACH,OAFD;;AAIAV,MAAAA,cAAc,CAACe,cAAf,GAAgCC,KAAK,IAAI;AACrC,YAAIA,KAAK,CAACC,SAAV,EAAqB;AACjB,eAAKR,KAAL,CAAWD,MAAX,CAAkBU,IAAlB,CAAuB,WAAvB,EAAoCX,QAApC,EAA8CS,KAAK,CAACC,SAApD;AACH;AACJ,OAJD;;AAMAjB,MAAAA,cAAc,CACTmB,WADL,GAEK5B,IAFL,CAEU6B,GAAG,IAAIpB,cAAc,CAACqB,mBAAf,CAAmCD,GAAnC,CAFjB,EAGK7B,IAHL,CAGU,MAAM;AACR,aAAKkB,KAAL,CAAWD,MAAX,CAAkBU,IAAlB,CAAuB,OAAvB,EAAgCX,QAAhC,EAA0CP,cAAc,CAACsB,gBAAzD;AACH,OALL;AAMH,KA9Ha;;AAEV,SAAKb,KAAL,GAAa;AACT;AACAH,MAAAA,eAAe,EAAE,EAFR;AAGT;AACAE,MAAAA,MAAM,EAAE/B,EAAE,CAAE,GAAEC,MAAM,CAAC6C,OAAQ,IAAG7C,MAAM,CAAC8C,SAAU,EAAvC;AAJD,KAAb;AAMH;;AAEDC,EAAAA,iBAAiB,GAAG;AAEhB;AACA,UAAMC,WAAW,GAAGzC,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAApB;AACAC,IAAAA,SAAS,CAACC,YAAV,CACKuC,YADL,CACkBjD,MAAM,CAACY,gBADzB,EAEKC,IAFL,CAEUqC,MAAM,IAAI;AACZF,MAAAA,WAAW,CAACjC,SAAZ,GAAwBmC,MAAxB;AACA,WAAKnB,KAAL,CAAWD,MAAX,CAAkBU,IAAlB,CAAuB,aAAvB;AACH,KALL,EAMKxB,KANL,CAMWmC,KAAK,IAAIjC,OAAO,CAACiC,KAAR,CAAcA,KAAd,CANpB,EAJgB,CAYhB;;AACA,UAAM7C,WAAW,GAAGC,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAApB;AACAC,IAAAA,SAAS,CAACC,YAAV,CAAuBC,eAAvB,CAAuCX,MAAM,CAACY,gBAA9C,EACKC,IADL,CACU,UAAUC,WAAV,EAAuB;AACzBR,MAAAA,WAAW,CAACS,SAAZ,GAAwBD,WAAxB;AACH,KAHL,EAIKE,KAJL,CAIW,UAAUC,GAAV,EAAe;AAAEC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAJ,GAAW,IAAX,GAAkBH,GAAG,CAACI,OAAlC;AAA6C,KAJzE,EAdgB,CAoBhB;;AACA,SAAKU,KAAL,CAAWD,MAAX,CAAkBsB,EAAlB,CAAqB,gBAArB,EAAuCvB,QAAQ,IAAI;AAC/C,YAAMP,cAAc,GAAG,IAAIC,iBAAJ,CAAsBvB,MAAM,CAACwB,WAA7B,CAAvB,CAD+C,CAG/C;;AACA,WAAKC,QAAL,CAAcC,SAAS,IAAI;AACvB,YAAIC,kBAAkB,GAAGD,SAAS,CAACE,eAAnC;AACAD,QAAAA,kBAAkB,CAACE,QAAD,CAAlB,GAA+BP,cAA/B;AACA,eAAO;AACHQ,UAAAA,MAAM,EAAE,KAAKC,KAAL,CAAWD,MADhB;AAEHF,UAAAA,eAAe,EAAED;AAFd,SAAP;AAIH,OAPD;AASA,UAAI0B,YAAY,GAAGL,WAAW,CAACjC,SAA/B;AACAsC,MAAAA,YAAY,CAACpB,SAAb,GAAyBC,OAAzB,CAAiCC,KAAK,IAAI;AACtCb,QAAAA,cAAc,CAACc,QAAf,CAAwBD,KAAxB,EAA+BkB,YAA/B;AACH,OAFD;;AAIA/B,MAAAA,cAAc,CAACe,cAAf,GAAgCC,KAAK,IAAI;AACrC,YAAIA,KAAK,CAACC,SAAV,EAAqB;AACjB,eAAKR,KAAL,CAAWD,MAAX,CAAkBU,IAAlB,CAAuB,WAAvB,EAAoCX,QAApC,EAA8CS,KAAK,CAACC,SAApD;AACH;AACJ,OAJD;;AAMAjB,MAAAA,cAAc,CACTmB,WADL,GAEK5B,IAFL,CAEU6B,GAAG,IAAIpB,cAAc,CAACqB,mBAAf,CAAmCD,GAAnC,CAFjB,EAGK7B,IAHL,CAGU,MAAM;AACR,aAAKkB,KAAL,CAAWD,MAAX,CAAkBU,IAAlB,CAAuB,OAAvB,EAAgCX,QAAhC,EAA0CP,cAAc,CAACsB,gBAAzD;AACH,OALL;AAMH,KA9BD;AAgCA,SAAKb,KAAL,CAAWD,MAAX,CAAkBsB,EAAlB,CAAqB,QAArB,EAA+B,CAACE,EAAD,EAAKC,WAAL,KAAqB;AAChD,WAAKxB,KAAL,CAAWH,eAAX,CAA2B0B,EAA3B,EAA+BE,oBAA/B,CAAoDD,WAApD;AACH,KAFD;AAIA,SAAKxB,KAAL,CAAWD,MAAX,CAAkBsB,EAAlB,CAAqB,WAArB,EAAkC,CAACE,EAAD,EAAKf,SAAL,KAAmB;AACjD,WAAKR,KAAL,CAAWH,eAAX,CAA2B0B,EAA3B,EAA+BG,eAA/B,CAA+C,IAAIC,eAAJ,CAAoBnB,SAApB,CAA/C;AACH,KAFD;AAIA,SAAKR,KAAL,CAAWD,MAAX,CAAkBsB,EAAlB,CAAqB,gBAArB,EAAuCE,EAAE,IAAI;AACzC,WAAKvB,KAAL,CAAWH,eAAX,CAA2B0B,EAA3B,EAA+BK,KAA/B;AACA,aAAO,KAAK5B,KAAL,CAAWH,eAAX,CAA2B0B,EAA3B,CAAP;AACApC,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAKY,KAAL,CAAWH,eAAvB;AACH,KAJD;;AAMAgC,IAAAA,MAAM,CAACC,QAAP,GAAkBD,MAAM,CAACE,cAAP,GAAwB,MAAM;AAC5C,WAAK/B,KAAL,CAAWD,MAAX,CAAkB6B,KAAlB;AACH,KAFD;AAGH,GAjFqC,CAmFtC;;;AA8CAI,EAAAA,MAAM,GAAG;AACL,wBACI;AAAA,mDAEI;AAAQ,QAAA,EAAE,EAAC,aAAX;AAAyB,QAAA,OAAO,EAAE,KAAK1D,WAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAFJ,eAGI;AAAK,QAAA,EAAE,EAAC,eAAR;AAAwB,QAAA,KAAK,EAAE;AAAE2D,UAAAA,MAAM,EAAE;AAAV,SAA/B;AAAA,gCACI;AAAO,UAAA,EAAE,EAAC,QAAV;AAAmB,UAAA,WAAW,MAA9B;AAA+B,UAAA,QAAQ,MAAvC;AAAwC,UAAA,KAAK;AAA7C;AAAA;AAAA;AAAA;AAAA,gBADJ,iCAKI;AAAO,UAAA,EAAE,EAAC,QAAV;AAAmB,UAAA,WAAW,MAA9B;AAA+B,UAAA,QAAQ,MAAvC;AAAwC,UAAA,KAAK;AAA7C;AAAA;AAAA;AAAA;AAAA,gBALJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAHJ;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AAaH;;AA/IqC;;AAkJ1C,eAAe/D,WAAf","sourcesContent":["import React from \"react\";\nimport io from 'socket.io-client'\nimport '../styles/home.style.css'\nimport { config } from '../config'\n\nclass BroadCaster extends React.Component {\n    constructor() {\n        super()\n        this.state = {\n            // client list\n            peerConnections: {},\n            // socket connection\n            socket: io(`${config.NODE_IP}:${config.NODE_PORT}`)\n        }\n    }\n\n    componentDidMount() {\n\n        // Use camera\n        const videoCamera = document.getElementById(\"camera\");\n        navigator.mediaDevices\n            .getUserMedia(config.VIDEO_CONSTRAINS)\n            .then(stream => {\n                videoCamera.srcObject = stream;\n                this.state.socket.emit(\"broadcaster\");\n            })\n            .catch(error => console.error(error));\n\n        // Use screen\n        const videoScreen = document.getElementById(\"screen\");\n        navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS)\n            .then(function (mediaStream) {\n                videoScreen.srcObject = mediaStream;\n            })\n            .catch(function (err) { console.log(err.name + \": \" + err.message); });\n\n        // Socket handler\n        this.state.socket.on(\"start-watching\", clientId => {\n            const peerConnection = new RTCPeerConnection(config.STUN_CONFIG);\n\n            // update state\n            this.setState(prevState => {\n                let newPeerConnections = prevState.peerConnections\n                newPeerConnections[clientId] = peerConnection\n                return {\n                    socket: this.state.socket,\n                    peerConnections: newPeerConnections\n                }\n            })\n\n            let streamCamera = videoCamera.srcObject;\n            streamCamera.getTracks().forEach(track => {\n                peerConnection.addTrack(track, streamCamera)\n            });\n\n            peerConnection.onicecandidate = event => {\n                if (event.candidate) {\n                    this.state.socket.emit(\"candidate\", clientId, event.candidate);\n                }\n            };\n\n            peerConnection\n                .createOffer()\n                .then(sdp => peerConnection.setLocalDescription(sdp))\n                .then(() => {\n                    this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n                });\n        });\n\n        this.state.socket.on(\"answer\", (id, description) => {\n            this.state.peerConnections[id].setRemoteDescription(description);\n        });\n\n        this.state.socket.on(\"candidate\", (id, candidate) => {\n            this.state.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n        });\n\n        this.state.socket.on(\"disconnectPeer\", id => {\n            this.state.peerConnections[id].close();\n            delete this.state.peerConnections[id];\n            console.log(this.state.peerConnections)\n        });\n\n        window.onunload = window.onbeforeunload = () => {\n            this.state.socket.close();\n        };\n    }\n\n    // Stop streamming\n    StopStreaming = () => {\n\n    }\n\n    // Start streaming\n    ShareScreen = () => {\n        const videoScreen = document.getElementById(\"screen\");\n\n        navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS)\n            .then(function (mediaStream) {\n                videoScreen.srcObject = mediaStream;\n            })\n            .catch(function (err) { console.log(err.name + \": \" + err.message); });\n\n        const peerConnection = new RTCPeerConnection(config.STUN_CONFIG);\n\n        // update state\n        this.setState(prevState => {\n            let newPeerConnections = prevState.peerConnections\n            newPeerConnections[clientId] = peerConnection\n            return {\n                socket: this.state.socket,\n                peerConnections: newPeerConnections\n            }\n        })\n\n        let streamScreen = videoScreen.srcObject;\n        streamScreen.getTracks().forEach(track => {\n            peerConnection.addTrack(track, streamScreen)\n        });\n\n        peerConnection.onicecandidate = event => {\n            if (event.candidate) {\n                this.state.socket.emit(\"candidate\", clientId, event.candidate);\n            }\n        };\n\n        peerConnection\n            .createOffer()\n            .then(sdp => peerConnection.setLocalDescription(sdp))\n            .then(() => {\n                this.state.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n            });\n    }\n\n    render() {\n        return (\n            <div>\n                User: hoangnd&nbsp;\n                <button id='control-btn' onClick={this.ShareScreen}>Share screen</button>\n                <div id='stream-screen' style={{ margin: '20px' }}>\n                    <video id='camera' playsInline autoPlay muted></video>\n                    &nbsp;\n                    &nbsp;\n                    &nbsp;\n                    <video id='screen' playsInline autoPlay muted></video>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default BroadCaster;"]},"metadata":{},"sourceType":"module"}