{"ast":null,"code":"var _jsxFileName = \"/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js\";\nimport React from \"react\";\nimport io from 'socket.io-client';\nimport '../styles/home.style.css';\nimport { config } from '../config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass BroadCaster extends React.Component {\n  constructor() {} // Stop streamming\n\n\n  componentDidMount() {\n    // client list\n    this.peerConnections = {}; // socket connection\n\n    this.socket = io(`${config.NODE_IP}:${config.NODE_PORT}`);\n    const video = document.querySelector(\"video\"); // Use camera\n\n    navigator.mediaDevices.getUserMedia(config.VIDEO_CONSTRAINS).then(stream => {\n      video.srcObject = stream;\n      this.socket.emit(\"broadcaster\");\n    }).catch(error => console.error(error)); // Use screen\n    // navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS)\n    //     .then(function (mediaStream) {\n    //         video.srcObject = mediaStream;\n    //         socket.emit(\"broadcaster\");\n    //     })\n    //     .catch(function (err) { console.log(err.name + \": \" + err.message); });\n    // Socket handler\n\n    this.socket.on(\"start-watching\", clientId => {\n      const peerConnection = new RTCPeerConnection(config);\n      this.peerConnections[clientId] = peerConnection;\n      let stream = video.srcObject;\n      stream.getTracks().forEach(track => {\n        peerConnection.addTrack(track, stream);\n      });\n\n      peerConnection.onicecandidate = event => {\n        if (event.candidate) {\n          this.socket.emit(\"candidate\", clientId, event.candidate);\n        }\n      };\n\n      peerConnection.createOffer().then(sdp => peerConnection.setLocalDescription(sdp)).then(() => {\n        this.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n      });\n    });\n    this.socket.on(\"answer\", (id, description) => {\n      this.peerConnections[id].setRemoteDescription(description);\n    });\n    this.socket.on(\"candidate\", (id, candidate) => {\n      this.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n    });\n    this.socket.on(\"disconnectPeer\", id => {\n      this.peerConnections[id].close();\n      delete this.peerConnections[id];\n    });\n\n    window.onunload = window.onbeforeunload = () => {\n      this.socket.close();\n    };\n  } // Start streaming\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"User: hoangnd\\xA0\", /*#__PURE__*/_jsxDEV(\"button\", {\n        id: \"control-btn\",\n        onClick: this.StartStream,\n        children: \"Start streaming\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"stream-screen\",\n        style: {\n          margin: '20px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"video\", {\n          playsInline: true,\n          autoPlay: true,\n          muted: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default BroadCaster;","map":{"version":3,"sources":["/home/hoangnd/Documents/hust/20202/project/livestream/client/src/pages/broadcaster.page.js"],"names":["React","io","config","BroadCaster","Component","constructor","componentDidMount","peerConnections","socket","NODE_IP","NODE_PORT","video","document","querySelector","navigator","mediaDevices","getUserMedia","VIDEO_CONSTRAINS","then","stream","srcObject","emit","catch","error","console","on","clientId","peerConnection","RTCPeerConnection","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","createOffer","sdp","setLocalDescription","localDescription","id","description","setRemoteDescription","addIceCandidate","RTCIceCandidate","close","window","onunload","onbeforeunload","render","StartStream","margin"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport io from 'socket.io-client'\nimport '../styles/home.style.css'\nimport { config } from '../config'\n\nclass BroadCaster extends React.Component {\n    constructor() {\n        \n    }\n\n    // Stop streamming\n    StopStreaming = () => {\n\n    }\n\n    componentDidMount() {\n        // client list\n        this.peerConnections = {};\n\n        // socket connection\n        this.socket = io(`${config.NODE_IP}:${config.NODE_PORT}`);\n        const video = document.querySelector(\"video\");\n\n        // Use camera\n        navigator.mediaDevices\n            .getUserMedia(config.VIDEO_CONSTRAINS)\n            .then(stream => {\n                video.srcObject = stream;\n                this.socket.emit(\"broadcaster\");\n            })\n            .catch(error => console.error(error));\n\n        // Use screen\n        // navigator.mediaDevices.getDisplayMedia(config.VIDEO_CONSTRAINS)\n        //     .then(function (mediaStream) {\n        //         video.srcObject = mediaStream;\n        //         socket.emit(\"broadcaster\");\n        //     })\n        //     .catch(function (err) { console.log(err.name + \": \" + err.message); });\n\n        // Socket handler\n        this.socket.on(\"start-watching\", clientId => {\n            const peerConnection = new RTCPeerConnection(config);\n            this.peerConnections[clientId] = peerConnection;\n\n            let stream = video.srcObject;\n            stream.getTracks().forEach(track => {\n                peerConnection.addTrack(track, stream)\n            });\n\n            peerConnection.onicecandidate = event => {\n                if (event.candidate) {\n                    this.socket.emit(\"candidate\", clientId, event.candidate);\n                }\n            };\n\n            peerConnection\n                .createOffer()\n                .then(sdp => peerConnection.setLocalDescription(sdp))\n                .then(() => {\n                    this.socket.emit(\"offer\", clientId, peerConnection.localDescription);\n                });\n        });\n\n        this.socket.on(\"answer\", (id, description) => {\n            this.peerConnections[id].setRemoteDescription(description);\n        });\n\n        this.socket.on(\"candidate\", (id, candidate) => {\n            this.peerConnections[id].addIceCandidate(new RTCIceCandidate(candidate));\n        });\n\n        this.socket.on(\"disconnectPeer\", id => {\n            this.peerConnections[id].close();\n            delete this.peerConnections[id];\n        });\n\n        window.onunload = window.onbeforeunload = () => {\n            this.socket.close();\n        };\n    }\n\n    // Start streaming\n    ShareScreen = () => {\n\n\n    }\n\n    render() {\n        return (\n            <div>\n                User: hoangnd&nbsp;\n                <button id='control-btn' onClick={this.StartStream}>Start streaming</button>\n                <div id='stream-screen' style={{ margin: '20px' }}>\n                    <video playsInline autoPlay muted></video>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default BroadCaster;"]},"metadata":{},"sourceType":"module"}